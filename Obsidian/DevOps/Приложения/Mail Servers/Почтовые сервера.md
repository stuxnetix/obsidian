**Почтовый сервер, сервер электронной почты, или мейл-сервер** - это программа, которая передаёт сообщение от одного компьютера к другому.

![[Pasted image 20240415235927.png]]

Как происходит передача почты: 

Юзер1 передает по SMTP (simple mail transport protocol) на почтовый сервер , который
по тому же протоколу передает на второй почтовый сервер , который в свою очередь передает по протоколу POP3/IMAP уже конечному пользователю. 

MTA (mail tranfer agent) - агент пересылки почты
MDA (mail delivery agent) - агент доставки почты
MUA (mail user agent) - постовый клиент

SMTP (simple mail tranfer protocol) - основной протокол обмена электронной почты. Порт 25
POP3 - протокол для приема сообщений электронной почты
IMAP - протокол для приема сообщений электронной почты.

MX (mail exchanger)- тип DNS записи
PTR (pointer) - DNS запись , которая связывает IP адрес с доменом
SPF (Sender Policy Framework) - текстовая запись в ТХТ-записи DNS домена.
Позволяет указать кто имеет право отправлять письма от имени домена.

DKIM (DomainKeys Identified Mail) - метод E-mail аутентификации. Предназначен для антифишинга и антиспама , уберегает содержимое сообщения при передачи между почтовыми клиентами.
DMARC (Domain-based Message Authentification,Reportingrand Conformance) - набор правил для писем от вашего имени , которые не прошли аутентификацию по SPF and DKIM.

Конфигурации:

OS Linux:

SSH 
Firewall Fail2Ban
MTA.Mail-server (POSTFIX)
PostFix Admin - для управлением почтовыми ящиками и доменами

ClamAV - антивирус
SpamAssassin - антиспам (имеет тенденцию к падению в рейтинге)
RSPAMD - антиспам (в приоритете)
Postgrey
AMaVIS - mail virus scanner
MysqL - БД 
Dovecot : MDA:POP3 and IMAP
Клиенты: Roundcube , Outlook , Thunderbird
Настройка DNS

Как происходит : Приходит мейл попадает на PostFix который в свою очередь спрашивает DNS
на предмет соответствия сервера отправки (от mail.ru например) , если все ОК , то идет запрос
в БД , БД говорит , что все ОК и отправляет в Postgrey (серый список) , который делает запрос 
серверу отправки и просит прислать письмо еще раз (имеется тайминг) , если все ок , то отправляет в AMaVIS
который отправляет в антивирус и антиспам , если все Ок идет отправка в PostFix и он отправляет письмо на HDD.
С HDD его подхватывает Dovecot и уже несет в клиент.

PostfixAdmin связывается с БД , чтобы там вести настройки домена и т.падению

Всю эту задачу может упростить MailCow (Dockerized)

[[Postfix]] [[SSH]] 